dimension 2

Pb_hydraulique pb
domaine dom

# BEGIN MESH #
Read_file geometry.geo ;
# END MESH #

# BEGIN PARTITION
Partition dom
{
    Partition_tool metis { nb_parts 2 }
    Larg_joint 2
    zones_name DOM
}
End
END PARTITION #

# BEGIN SCATTER
Scatter DOM.Zones dom
END SCATTER #

VDF dis

Scheme_Euler_explicit mon_schema
Read mon_schema
{
    tinit   0
    tmax    30.
    dt_min  2.e-7
    dt_max  2.
    dt_impr 1.
    dt_sauv 300.
    seuil_statio 1.e-7
    facsec  0.5
}

Fluide_Incompressible fluide
Read fluide
{
    mu      Champ_Uniforme 1 1.8e-3
    rho     Champ_Uniforme 1 10000
    lambda  Champ_Uniforme 1 12 
    Cp      Champ_Uniforme 1 145
    beta_th Champ_Uniforme 1 1.3e-4
}

Champ_Uniforme gravite
Read gravite 2  9.81   0.
Associate fluide gravite

Associate pb dom
Associate pb fluide
Associate pb mon_schema

Discretize pb dis

Read pb
{
    Navier_Stokes_standard
    {
        solveur_pression Petsc cholesky { }
        convection { amont }
        diffusion { }
        initial_conditions  { vitesse Champ_Uniforme 2 0 0 }
        boundary_conditions 
        {
            droite  paroi_fixe
            gauche  paroi_fixe
            bas     Frontiere_ouverte_vitesse_imposee   Champ_front_Uniforme 2 0. 1.
            haut    Frontiere_ouverte_pression_imposee  Champ_front_Uniforme 1 20.
        }
    }


    Post_processing
    {
        Definition_champs
        {
            energie_cine Transformation
            {
                methode formule expression 1 0.5*rho*norme_u*norme_u
                sources
                {
                    RefChamp { Pb_champ pb masse_volumique nom_source rho } ,
                    Transformation
                    {
                        methode norme 
                        localisation elem
                        source RefChamp { Pb_champ pb vitesse }
                        nom_source norme_u
                    }
                }
            }

            pressure_tot Transformation
            {
                methode formule expression 1 p_pa+p_hydro-rho*9.81*5.+energie_cine
                sources_reference { energie_cine }
                sources 
                {
                    RefChamp { Pb_champ pb pression_pa nom_source p_pa } ,
                    RefChamp { Pb_champ pb pression_hydrostatique nom_source p_hydro } ,
                    RefChamp { Pb_champ pb masse_volumique nom_source rho }
                }
            }
        }
        Format lata 
        Fields dt_post 1
        {
            pressure                    elem
            pression                    elem
            pression_pa                 elem
            P_star                      elem
            vitesse                     faces
            energie_cine                elem
            energie_cinetique_totale    elem
            energie_cinetique_elem      elem

            pression_hydrostatique      elem
            pressure_tot                elem
        }

        Probes 
        {
            pressure    grav    pressure                    periode 0.1 segment 40  5.   0.    5.   10.
            pression    grav    pression                    periode 0.1 segment 40  5.   0.    5.   10.
            pression_pa grav    pression_pa                 periode 0.1 segment 40  5.   0.    5.   10.
            p_star      grav    p_star                      periode 0.1 segment 40  5.   0.    5.   10.

            ec          grav    energie_cine                periode 0.1 segment 40  5.   0.    5.   10.
            ec_totale   grav    energie_cinetique_totale    periode 0.1 segment 40  5.   0.    5.   10.
            ec_elem     grav    energie_cinetique_elem      periode 0.1 segment 40  5.   0.    5.   10.

            p_tot       grav    pressure_tot                periode 0.1 segment 40  5.   0.    5.   10.
            p_hydro     grav    pression_hydrostatique      periode 0.1 segment 40  5.   0.    5.   10.
            p_hydro2    grav    pression_hydrostatique      periode 0.1 segment 40  0.   5.   10.    5.
        }
    }

}

Solve pb
End

