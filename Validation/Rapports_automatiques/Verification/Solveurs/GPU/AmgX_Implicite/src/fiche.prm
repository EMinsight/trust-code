Parameters {
	Title "Convergence of Euler implicit scheme (facsec=1000) with different GPU solvers from AmgX library"
	Author "Pierre LEDAC"
        VersionTrio_U 1.8.3
        Description "Flow calculation (laminar, permanent, 2 MPI parallel processes) with TRUST on different meshes (3D unstructured)"
   
   
 	TestCase 10x10x10 amgx_fgmres_gs.data 2
   
 	TestCase 10x10x10 amgx_bicgstab_gs.data 2
   
 	TestCase 10x10x10 amgx_gc_gs.data 2
   
 	TestCase 10x10x10 amgx_fgmres_c-amg.data 2
 
 
	Description "Several solvers are tested: BiCGStab, FGMRES (Flexible GMRES), or GCP (Conjugate Gradient)"
	Description "Prefer GS preconditioner (Gauss Seidel version) to Jacobi (diagonal) one (very slow to converge)"
	Description "and even to multigrid ones (C-AMG or SA-AMG) as re-setup (matrix coefficients change) on GPU is quite expensive"
	Description "Important: GMRES fails to return a valid solution with AmgX library."
	Description "Conclusion: FGMRES or BiCGStab+GS may be the faster choice for using GPU solver for an implicit scheme."
}
   
Chapter 
{
	Title "Solver convergence with different solvers on mesh 40x10x10x10" 
        figure 
            { 
        	description "Relative residual  \latex_( $\lVert Ax(n)-b \rVert / \lVert Ax(0)-b \rVert$  \latex_) during the fist time step:"
		Width 12cm
		include_description_curves 0
		labelX "Iteration"
        	labelY "Residual"
		logy 
	        curve {
			file 10x10x10/amgx_fgmres_gs.res
			columns ($1) ($2)
			legende "amgx_fgmres_gs"
			style linespoints
		}
	        curve {
			file 10x10x10/amgx_bicgstab_gs.res
			columns ($1) ($2)
			legende "amgx_bicgstab_gs"
			style linespoints
		}
	        curve {
			file 10x10x10/amgx_gc_gs.res
			columns ($1) ($2)
			legende "amgx_gc_gs"
			style linespoints
		}
	        curve {
			file 10x10x10/amgx_fgmres_c-amg.res
			columns ($1) ($2)
			legende "amgx_fgmres_c-amg"
			style linespoints
		}
	}
}
 

   
Chapter 
{
	Title "Time convergence with different solvers on mesh 40x10x10x10" 
        figure 
            { 
        	description "Relative residual  \latex_( $\lVert dI(n)/dt \rVert / \lVert dI(0)/dt \rVert$  \latex_) up to convergence:"
		Width 12cm
		include_description_curves 0
		labelX "Time"
        	labelY "Residual"
		logy 
	        curve {
			file 10x10x10/amgx_fgmres_gs.dt_ev
			columns ($1) ($4)
			legende "amgx_fgmres_gs"
			style linespoints
		}
	        curve {
			file 10x10x10/amgx_bicgstab_gs.dt_ev
			columns ($1) ($4)
			legende "amgx_bicgstab_gs"
			style linespoints
		}
	        curve {
			file 10x10x10/amgx_gc_gs.dt_ev
			columns ($1) ($4)
			legende "amgx_gc_gs"
			style linespoints
		}
	        curve {
			file 10x10x10/amgx_fgmres_c-amg.dt_ev
			columns ($1) ($4)
			legende "amgx_fgmres_c-amg"
			style linespoints
		}
	}
}
 

   
Chapter 
{
	Title "Friction drag with different solvers on mesh 40x10x10x10" 
        figure 
            { 
        	description "Fx(Wall) up to convergence:"
		Width 12cm
		include_description_curves 0
		labelX "Time"
        	labelY "Drag [N]"
	        curve {
			file 10x10x10/amgx_fgmres_gs_pb_Contrainte_visqueuse.out
			columns ($1) ($5)
			legende "amgx_fgmres_gs"
			style linespoints
		}
	        curve {
			file 10x10x10/amgx_bicgstab_gs_pb_Contrainte_visqueuse.out
			columns ($1) ($5)
			legende "amgx_bicgstab_gs"
			style linespoints
		}
	        curve {
			file 10x10x10/amgx_gc_gs_pb_Contrainte_visqueuse.out
			columns ($1) ($5)
			legende "amgx_gc_gs"
			style linespoints
		}
	        curve {
			file 10x10x10/amgx_fgmres_c-amg_pb_Contrainte_visqueuse.out
			columns ($1) ($5)
			legende "amgx_fgmres_c-amg"
			style linespoints
		}
	}
}
 

  
Chapter 
{
	Title "RAM evolution for different solvers on mesh 40x10x10x10" 
        figure 
            { 
        	description "RAM (MB) during calculation:"
		Width 12cm
		include_description_curves 0
		labelX "Time step"
        	labelY "RAM [MB]"
	        curve {
			file 10x10x10/amgx_fgmres_gs.ram
			columns ($1) ($2)
			legende "amgx_fgmres_gs"
			style linespoints
		}
	        curve {
			file 10x10x10/amgx_bicgstab_gs.ram
			columns ($1) ($2)
			legende "amgx_bicgstab_gs"
			style linespoints
		}
	        curve {
			file 10x10x10/amgx_gc_gs.ram
			columns ($1) ($2)
			legende "amgx_gc_gs"
			style linespoints
		}
	        curve {
			file 10x10x10/amgx_fgmres_c-amg.ram
			columns ($1) ($2)
			legende "amgx_fgmres_c-amg"
			style linespoints
		}
	}
}
 

Chapitre {
        Titre "Time needed to copy and solve the linear system on GPU (during the last time step)"
   
        Table 
        {                
                Title "Mesh 40x10x10x10"
                nb_columns 2
                label Copy[s] | Solve[s]
                line {
                        legend "amgx_fgmres_gs"
                        file 10x10x10/amgx_fgmres_gs.cpu
                        last_line
                     }
                line {
                        legend "amgx_bicgstab_gs"
                        file 10x10x10/amgx_bicgstab_gs.cpu
                        last_line
                     }
                line {
                        legend "amgx_gc_gs"
                        file 10x10x10/amgx_gc_gs.cpu
                        last_line
                     }
                line {
                        legend "amgx_fgmres_c-amg"
                        file 10x10x10/amgx_fgmres_c-amg.cpu
                        last_line
                     }
	}
 
        }

   
 Chapter {
        Title "Computer performance"
        tableau_performance {
        }
}
       
