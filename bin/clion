#!/bin/bash
# Run IDE CLion and configure as best as possible on Trust or Baltik project
clion=`which clion.sh`
[ "$clion" = "" ] && echo "IDE Clion not found. Check clion.sh is into your PATH." && exit -1

# Detect Trust or Baltik environnement
env=`ls env* ../env* 2>/dev/null`
[ "$env" = "" ] && echo "No project found. Go under Baltik or Trust and retry..." && exit 1

# Load environment
source $env
# Look for CMakeLists.txt
CMakeLists=`ls build/src/CMakeLists.txt ../build/src/CMakeLists.txt src/CMakeLists.txt ../src/CMakeLists.txt 2>/dev/null`
[ "$CMakeLists" = "" ] && echo "No CMakeLists.txt found." && exit 1
CMakeLists=`pwd`/$CMakeLists
PROJECT_ROOT=`dirname $CMakeLists`
# Baltik or TRUST ?
if [ "`echo $env | grep TRUST`" = "" ]
then
   baltik=1
   BUILD_ROOT=$PROJECT_ROOT/exec      
else
   baltik=0
   BUILD_ROOT=$TRUST_ROOT/MonoDir_mpi/src
fi
[ ! -d $BUILD_ROOT ] && echo "Build the project before in debug mode! make debug" && exit 1
# Configuration for Clion:
cd $PROJECT_ROOT
# Create a link to build directory to avoid change CLion settings
rm -r -f cmake-build-debug
echo "Creating a link $PROJECT_ROOT/cmake-build-debug -> $BUILD_ROOT"
ln -s -f $BUILD_ROOT cmake-build-debug
echo "Running Clion on $CMakeLists project..."
echo "Raccourcis:"
echo "ctrl+F12          : liste des methodes de la classe"
echo "alt+haut|bas      : naviguer d'une methode a l'autre"
echo "ctrl+E            : derniers fichiers ouverts"
$clion $CMakeLists

