#!/bin/bash
# TRUST initialization script
if [ "$BASH" = "" ]
then
   echo "Warning! TRUST environment is not initialized cause"
   echo "the bash shell is the only shell script supported by TRUST"
   echo "and you are using another shell. So first run:"
   echo "$ bash"
else
   ############################################################################
   # As people has great trouble to not forget source or . before ./Init_TRUST
   ############################################################################
   command=`basename $0 2>/dev/null`
   if [ "$command" = Init_TRUST ]
   then
      echo "Error! You don't initialize the TRUST environment with:"
      echo "$0"
      echo 
      echo "Please, run:"  
      echo "source $0"
      echo "Or:"
      echo ". $0"
      exit -1
   fi
   
   ############################
   # Detect and set TRUST_ROOT
   ############################ 
   if [ "$BASH_SOURCE" != "" ]
   then
      # For bash > 3.x, $BASH_SOURCE help to know TRUST_ROOT
      OLDPWD_SAVED=$OLDPWD
      cd `dirname $BASH_SOURCE`/..
      TRUST_ROOT=`pwd`
      cd - 1>/dev/null 2>&1
   else
      echo "Warning: bash 3.x not installed. Soon obsolete."
      TRUST_ROOT=path_to_trio
   fi
   export TRUST_ROOT

   #################################
   # Print some infos on the version
   #################################
   export TRUST_VERSION=`awk '/version/ && /Release notes/ {print $4;exit}' $TRUST_ROOT/RELEASE_NOTES`
   export TRUST_MAIL=triou@cea.fr
   echo "TRUST v$TRUST_VERSION support : $TRUST_MAIL"

   ###################################
   # Initialize the TRUST environment
   ###################################
   source $TRUST_ROOT/env/trio_u.env

   ##########
   # Finalize
   ##########
   if [ "$BASH_SOURCE" != "" ]
   then
      # For bash > 3.x, reset OLDPWD
      OLDPWD=$OLDPWD_SAVED
   fi
fi
