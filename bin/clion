#!/bin/bash
# Run IDE CLion and configure as best as possible on Trust or Baltik project
clion=`which clion.sh`
[ "$clion" = "" ] && echo "IDE Clion not found. Check clion.sh is into your PATH." && exit -1

# Detect Trust or Baltik environnement
env=`ls env* ../env* 2>/dev/null`
if [ "$env" != "" ]
then
   # Load environment
   source $env
   # Look for CMakeLists.txt
   CMakeLists=`ls build/src/CMakeLists.txt ../build/src/CMakeLists.txt src/CMakeLists.txt ../src/CMakeLists.txt 2>/dev/null`
   if [ "$CMakeLists" != "" ]
   then 
      CMakeLists=`pwd`/$CMakeLists
      PROJECT_ROOT=`dirname $CMakeLists`
      echo "Running Clion on $CMakeLists project..."

      # Configuration for Clion:
      cd $PROJECT_ROOT
      BUILD_ROOT=`pwd`/exec 	# Baltik project
      [ ! -d $BUILD_ROOT ] && BUILD_ROOT=$TRUST_ROOT/MonoDir_mpi/src	# Trust project
      [ ! -d $BUILD_ROOT ] && echo "Build the project before !" && exit

      # Create a link to build directory to avoid change CLion settings
      rm -r -f cmake-build-debug
      ln -s -f $BUILD_ROOT cmake-build-debug

      # Run Clion on the project
      $clion $CMakeLists &
   else
      echo "No CMakeLists.txt found."
   fi
else
   echo "No project found. Go under Baltik or Trust and retry..."
   exit -1 
fi
