#!/bin/bash
rep_exec=$rep_dev/exec
rep_exec_opt=$rep_dev/exec_opt
fichier=$rep_dev/.Fichiers_atelier.html
D=$TRUST_ROOT/doc
cd $rep_dev
mes_dbg=""
mes_opt=""
if [ -f $rep_exec/TRUST ]
then
   mes_dbg=`ls -la $rep_exec/TRUST | $TRUST_Awk '{print $6,$7,$8,"TRUST"}'`
fi
if [ -f $rep_exec_opt/TRUST_opt ]
then
   mes_opt=`ls -la $rep_exec_opt/TRUST_opt | $TRUST_Awk '{print $6,$7,$8,"TRUST_opt"}'`
fi
BUTTON1=""
BUTTON2=""
liste_suffixe="h | c cpp f"
# Ecriture du fichier :
cree_en_tete.ihm > $fichier
echo "<PRE><HR><h1>Workbench to create my TRUST version</h1><HR><TABLE CELLSPACING=0 CELLPADDING=0><TR><TD><FORM METHOD="Compile" ACTION="$TRUST_ROOT/form/Compiler_opt.ksh?"><input type="submit" value="Compile"> my optimised version <a href=$rep_exec_opt/.Makefile.nom>Edit makefile</a> $mes_opt</TD></FORM><TD><FORM METHOD="Test" ACTION="$TRUST_ROOT/form/Tester_opt.ksh?"><input type="submit" value="Test"> my optimised version on test cases reference <a href=$rep_exec_opt/.tests.html>See results</a></TD></FORM></TR><TR><TD><FORM METHOD="Compile" ACTION="$TRUST_ROOT/form/Compiler_dbg.ksh?"><input type="submit" value="Compile"> my debug version <a href=$rep_exec/.Makefile.nom>Edit makefile</a> $mes_dbg</TD></FORM><TD><FORM METHOD="Test" ACTION="$TRUST_ROOT/form/Tester_dbg.ksh?"><input type="submit" value="Test"> my debug version on test cases reference <a href=$rep_exec/.tests.html>See results</a></TD></FORM></TR></TABLE><HR><TABLE CELLSPACING=0 CELLPADDING=0><TR><TD><FORM METHOD="Create" ACTION="$rep_dev/.Modeles.html"><input type="submit" value="Create"> a new class from patterns</TD></FORM><TD><FORM METHOD="CreMaDoc" ACTION="$TRUST_ROOT/form/CreMaDoc.ksh?"><input type="submit" value="Create"> my HTML classes documentation <a href=$rep_dev/Doc/index.html>See index</a></TD></FORM></TR><TR><TD><FORM METHOD="Find" ACTION="$TRUST_ROOT/form/Rechercher.ksh?"><input type="submit" value="Find"> a string in TRUST files <a href=$rep_dev/.Recherche.html>See results</a></TD></FORM><TD><FORM METHOD="Open" ACTION="$TRUST_ROOT/form/Term_atelier.ksh?"><input type="submit" value="Open"> a terminal</TD></FORM></TR></TABLE>"$BUTTON1"<HR>"$BUTTON2"<HR>" >> $fichier

echo "<LI> Include files:" >> $fichier
include=1
for suffixe in $liste_suffixe
do
   if [ $suffixe = "|" ]
   then
      echo " <LI> Source files :" >> $fichier
      include=0
   else
    files=`ls *.$suffixe 2>/dev/null`
      for fic in $files
      do
         NOM=`basename $fic`
	 blanc=`echo $NOM | $TRUST_Awk '{blanc="";for (i=0;i<22-length($0);i++) blanc=blanc" ";print blanc}'`
	 if [ ! -f $rep_dev/.$NOM ]
	 then
	    message=$blanc"New            "
	 else
	    fic_prec=`cat $rep_dev/.$NOM`/$NOM
	    diff $fic_prec $fic > $rep_dev/.diff_$NOM
            cree_diff.html $fic_prec $fic $rep_dev/.diff_$NOM
	    if [ "`cat $rep_dev/.diff_$NOM`" = "" ] || [ "`cat $rep_dev/.diff_$NOM`" = "Files are identical" ]
	    then
	       message=$blanc"Not modified       "
	    else
	       message=$blanc"Modified  <a href="$rep_dev/.diff_$NOM.html">Differences</a>"
	    fi
	 fi
	 if [ $include = "1" ]
	 then
	    if [ -f $rep_exec$OPT/.$NOM ]
	    then
	       message=$message"  "`cd $rep_exec$OPT;wc -l .$NOM | $TRUST_Awk '{print $1}'`" modified files"
            else
               message=""
	    fi
	 fi
         echo "<a href="$fic">$NOM</a>$message" >> $fichier
      done
   fi
done

echo "<HR>
</body>
</html> " >> $fichier

# Cree deux fichiers pour visualiser le makefile
if [ -d $rep_exec ]
then
   echo $rep_exec/Makefile > $rep_exec/.Makefile.nom
fi
if [ -d $rep_exec_opt ]
then
   echo $rep_exec_opt/Makefile > $rep_exec_opt/.Makefile.nom
fi
