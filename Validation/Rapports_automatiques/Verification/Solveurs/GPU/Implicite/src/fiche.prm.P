Parameters {
	Title "Convergence of Euler implicit scheme (facsec=1000) with different GPU solvers from AmgX library"
	Author "Pierre LEDAC"
        VersionTrio_U 1.8.3
        Description "Flow calculation (laminar, permanent, 2 MPI parallel processes) with TRUST on different meshes (3D unstructured)"
#Pforeach _mesh_ ( _meshes_ )   
#Pforeach _cas_ ( _liste_cas_ )   
 	TestCase _mesh_ _cas_.data _cpu_
#Pendforeach(_cas_) 
#Pendforeach(_mesh_) 
	Description "Several solvers are tested: BiCGStab, FGMRES (Flexible GMRES), or GCP (Conjugate Gradient)"
	Description "Prefer SSOR preconditioner (Gauss Seidel version) to Jacobi (diagonal) one (very slow to converge)"
	Description "and even to multigrid ones (C-AMG or SA-AMG) as re-setup (matrix coefficients change) on GPU is quite expensive"
	Description "Important: GMRES fails to return a valid solution with AmgX library."
	Description "Conclusion: FGMRES or BiCGStab+SSOR may be the faster choice for using GPU solver for an implicit scheme."
}
#Pforeach _mesh_ ( _meshes_ )   
Chapter 
{
	Title "Solver convergence with different solvers on mesh 40x_mesh_" 
        figure 
            { 
        	description "Relative residual  \latex_( $\lVert Ax(n)-b \rVert / \lVert Ax(0)-b \rVert$  \latex_) during the fist time step:"
		Width 12cm
		include_description_curves 0
		labelX "Iteration"
        	labelY "Residual"
		logy 
#Pforeach _cas_ ( _liste_cas_ )
	        curve {
			file _mesh_/_cas_.res
			columns ($1) ($2)
			legende "_cas_"
			style linespoints
		}
#Pendforeach(_cas_)
	}
}
#Pendforeach(_mesh_) 

#Pforeach _mesh_ ( _meshes_ )   
Chapter 
{
	Title "Time convergence with different solvers on mesh 40x_mesh_" 
        figure 
            { 
        	description "Relative residual  \latex_( $\lVert dI(n)/dt \rVert / \lVert dI(0)/dt \rVert$  \latex_) up to convergence:"
		Width 12cm
		include_description_curves 0
		labelX "Time"
        	labelY "Residual"
		logy 
#Pforeach _cas_ ( _liste_cas_ )
	        curve {
			file _mesh_/_cas_.dt_ev
			columns ($1) ($4)
			legende "_cas_"
			style linespoints
		}
#Pendforeach(_cas_)
	}
}
#Pendforeach(_mesh_) 

#Pforeach _mesh_ ( _meshes_ )   
Chapter 
{
	Title "Friction drag with different solvers on mesh 40x_mesh_" 
        figure 
            { 
        	description "Fx(Wall) up to convergence:"
		Width 12cm
		include_description_curves 0
		labelX "Time"
        	labelY "Drag [N]"
#Pforeach _cas_ ( _liste_cas_ )
	        curve {
			file _mesh_/_cas__pb_Contrainte_visqueuse.out
			columns ($1) ($5)
			legende "_cas_"
			style linespoints
		}
#Pendforeach(_cas_)
	}
}
#Pendforeach(_mesh_) 

#Pforeach _mesh_ ( _meshes_ )  
Chapter 
{
	Title "RAM evolution for different solvers on mesh 40x_mesh_" 
        figure 
            { 
        	description "RAM (MB) during calculation:"
		Width 12cm
		include_description_curves 0
		labelX "Time step"
        	labelY "RAM [MB]"
#Pforeach _cas_ ( _liste_cas_ )
	        curve {
			file _mesh_/_cas_.ram
			columns ($1) ($2)
			legende "_cas_"
			style linespoints
		}
#Pendforeach(_cas_)
	}
}
#Pendforeach(_mesh_) 

Chapitre {
        Titre "Time needed to copy and solve the linear system on GPU (during the last time step)"
#Pforeach _mesh_ ( _meshes_ )   
        Table 
        {                
                Title "Mesh 40x_mesh_"
                nb_columns 2
                label Copy[s] | Solve[s]
#Pforeach _cas_ ( _liste_cas_ )
                line {
                        legend "_cas_"
                        file _mesh_/_cas_.cpu
                        last_line
                     }
#Pendforeach(_cas_)
	}
#Pendforeach(_mesh_) 
        }

   
 Chapter {
        Title "Computer performance"
        tableau_performance {
        }
}
       
