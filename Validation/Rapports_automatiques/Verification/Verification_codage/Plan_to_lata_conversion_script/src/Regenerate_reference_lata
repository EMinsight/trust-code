#!/bin/bash

# Generate reference data from jdd1 and jdd2.
# To run in the case where reference data should be modified ONLY!
# Trust environnment should be sourced first!

# PATH to the validation form
CWD="`pwd`"

# Generate the reference lata in $TRUST_TMP
cd $TRUST_TMP

##########################
# Copy the 1st test case #
##########################
trust -copy Plan_to_lata_conversion_script_jdd1

# Run test case and generate .plan files
cd Plan_to_lata_conversion_script_jdd1
trust Plan_to_lata_conversion_script_jdd1 1>out 2>&1

# Convert .plan files to .lata format
python $TRUST_ROOT/Outils/lata2dx/lata2dx/Plan_to_lata.py Plan_to_lata_conversion_script_jdd1_SONDE_PX1Z TwoDimRepresentation -lp #1>/dev/null 2>&1
python $TRUST_ROOT/Outils/lata2dx/lata2dx/Plan_to_lata.py Plan_to_lata_conversion_script_jdd1_SONDE_PX1Z.plan Plan_to_lata_conversion_script_jdd1_SONDE_PX1Z #1>/dev/null 2>&1 
python $TRUST_ROOT/Outils/lata2dx/lata2dx/Plan_to_lata.py Plan_to_lata_conversion_script_jdd1_SONDE_PXY1  Plan_to_lata_conversion_script_jdd1_SONDE_PXY1.lata #1>/dev/null 2>&1 
python $TRUST_ROOT/Outils/lata2dx/lata2dx/Plan_to_lata.py Plan_to_lata_conversion_script_jdd1_SONDE_VXY0 #1>/dev/null 2>&1
python $TRUST_ROOT/Outils/lata2dx/lata2dx/Plan_to_lata.py Plan_to_lata_conversion_script_jdd1_SONDE_PINCLINED #1>/dev/null 2>&1 
python $TRUST_ROOT/Outils/lata2dx/lata2dx/Plan_to_lata.py Plan_to_lata_conversion_script_jdd1_SONDE_PXYZ #1>/dev/null 2>&1 
python $TRUST_ROOT/Outils/lata2dx/lata2dx/Plan_to_lata.py Plan_to_lata_conversion_script_jdd1_SONDE_V4YZ -l #1>/dev/null 2>&1


# Create the folder in which we copy *.lata* files generated by the script
# Do not copy the lata file in that folder since when we want to create a jdd'i', lata format is converted to lml format

fold="ref_jdd1"
[ -d $fold ] && rm -r $fold
mkdir $fold

mv *.lata* $fold
tar -zcf $fold.tar.gz $fold

rm -r $fold
mv $fold.tar.gz $CWD
cd ..
rm -r Plan_to_lata_conversion_script_jdd1
echo "==============================================================================================="
echo "Temporary folders have been deleted and reference results in $fold should be correctly updated!"
echo "check this in folder:"
echo "$CWD"
echo "==============================================================================================="
##########################
# Copy the 2nd test case #
##########################
trust -copy Plan_to_lata_conversion_script_jdd2

# Run test case and generate .plan files
cd Plan_to_lata_conversion_script_jdd2
trust Plan_to_lata_conversion_script_jdd2 1>out 2>&1

# Convert .plan files to .lata format
python $TRUST_ROOT/Outils/lata2dx/lata2dx/Plan_to_lata.py Plan_to_lata_conversion_script_jdd2_P_PROBE.plan -l #1>/dev/null 2>&1
python $TRUST_ROOT/Outils/lata2dx/lata2dx/Plan_to_lata.py Plan_to_lata_conversion_script_jdd2_V_PROBE.plan toto_obstacle.lata -l #1>/dev/null 2>&1


# Create the folder in which we copy *.lata* files generated by the python script which will be considered as a reference
# Do not copy the lata file in that folder since when we want to create a jdd'i', lata format is converted to lml format

fold="ref_jdd2"
[ -d $fold ] && rm -r $fold
mkdir $fold

mv *.lata* $fold
tar -zcf $fold.tar.gz $fold

rm -r $fold
mv $fold.tar.gz $CWD
cd ..
rm -r Plan_to_lata_conversion_script_jdd2
echo "==============================================================================================="
echo "Temporary folders have been deleted and reference results in $fold should be correctly updated!"
echo "check this in folder:"
echo "$CWD"
echo "==============================================================================================="
