#!/bin/bash
force=no && [ ${#1} != 0 ] && [ $1 = "-force" ] && force=yes
[ ${#TRUST_ROOT} = 0 ] && echo "The TRUST_ROOT variable is not definied !" && exit
echo "Building $TRUST_LIB/TRUST$COMM$OPT.a..."
# Creation de ce qui n'existe peut etre pas :
rep=${TRUST_ROOT%TRUST}
TMP=$TRUST_TMP/.tmpo_`basename $rep`
rm -r -f $TMP
mkdir $TMP
cd $TMP
for dir in `cat $TRUST_ENV/rep.TRUST`
do
   for file in `ls $TRUST_ROOT/$dir/*.o 2>/dev/null`
   do
      source=${file%.o}
      [ -f $source.cpp ] || [ -f $source.f ] || [ -f $source.c ] && ln -sf $file . 2>/dev/null
   done
done
# Efface l'archive car certains fichiers .o sont supprimes
rm -f $TRUST_LIB/TRUST$COMM$OPT.a
ar ru $TRUST_LIB/TRUST$COMM$OPT.a [A-F]*.o 2>&1 | grep -v creating
ar ru $TRUST_LIB/TRUST$COMM$OPT.a [G-Q]*.o
ar ru $TRUST_LIB/TRUST$COMM$OPT.a [R-Z]*.o
ar ru $TRUST_LIB/TRUST$COMM$OPT.a [a-z]*.o
