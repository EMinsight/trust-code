Parameters {
	Title "Vérification de la conduction thermique instationnaire"
	Description "On considère un problème de conduction thermique instationnaire.  On compare la solution obtenue par GENEPI à la solution analytique.  La température est imposée en entrée et sortie du domaine (cf. jeu de données).  On compare le profil de température dans la direction $x$ ainsi que le champ de température bidimensionnel.  On compare également les flux conductifs sur les parois en entrée et sortie."
	Author "D. Jamet"
	TestCase "." "conduc_genepi_instat.data"
	IncludeData 1
}

Chapter {
	Title "Champs de température"
	Description "On compare les champs de température calculé par GENEPI et analytique.  Cette comparaison se fait sur un profil en $y=cte$ et sur le champ 2D."

	Figure {
                Include_Description_Curves 0
		Title "Comparaison des profils calculé et analytique"
		Dimension 2
		LabelX "x"
		LabelY "T"

		width 7cm

		Curve {
			legend "analytique"
			file ./ref_gnuplot.dat
			Style lines
}
		Curve {
			legend "EF t= 0.0"
			origin "Trio_U"
			segment ./conduc_genepi_instat.data temperature_x 0.
			Style linespoints
			columns ($1) ($2)
                }

		Curve {
			legend "EF t= 0.5"
			origin "Trio_U"
			segment ./conduc_genepi_instat.data temperature_x 0.5
			Style linespoints
			columns ($1) ($2)
                }

		Curve {
			legend "EF t= 1.0"
			origin "Trio_U"
			segment ./conduc_genepi_instat.data temperature_x 1.
			Style linespoints
			columns ($1) ($2)
                }

		Curve {
			legend "EF t= 2.0"
			origin "Trio_U"
			segment ./conduc_genepi_instat.data temperature_x 2.
			Style linespoints
			columns ($1) ($2)
                }

		Curve {
			legend "EF t=10.0"
			origin "Trio_U"
			segment ./conduc_genepi_instat.data temperature_x 10.
			Style linespoints
			columns ($1) ($2)
                }
	}

	visu {
                Title "Champ de température à $t=0.5$"
                description "On trace le champ d'écart entre la température calculée et la solution analytique.  La solution analytique est représentée par des isovaleurs du champ de température."
                mesh ./conduc_genepi_instat.lata dom
		cycles 1
                instruction_visit DefineScalarExpression("ERREUR_SOM_dom","TEMPERATURE_SOM_dom-(-100./0.5*coord(dom)[0])")
                pseudocolor ./conduc_genepi_instat.lata dom TEMPERATURE SOM
        }


}


Chapter {
	Title "Flux conductifs aux frontières du domaine"
	Description "Les flux conductifs calculés par GENEPI en $x=0$ et $x=L$ sont comparés aux flux théoriques.  L'erreur correspondante est également donnée."


	Table {
		Title "Comparaison théorie/numérique"
		nb_columns 2
		label  flux  gauche  | flux droit
		line {
			legend theorie
			Version "1.5.3-beta_build_180907"
			values 5. -5.
			alias ref
		}
		line {
			legend calcul
			origin "Trio_U"
			Version "1.5.3-beta_build_180907"
			nb_columns_file 6
			file ./conduc_genepi_instat_fin.out
			columns $2 $5
		}
		line {
			legend ecart_relatif
			alias erreur
			origin "Trio_U"
			Version "1.5.3-beta_build_180907"
			difference ecart_relatif calcul ref
			 display_line 0	
		}
		line {
	        	legend "erreur en %"
			alias err_bis
		        difference formule   erreur ref int(v1*10000)/100.
	        }
	}

	Figure {
                Include_Description_Curves 0
		Title "Comparaison des profils calculé et analytique"
		Dimension 2
		LabelX "x"
		LabelY "flux"

		width 7cm

		Curve {
			legend "EF"
			origin "Trio_U"
			file conduc_genepi_instat_pb_Diffusion_chaleur.out
			Style linespoints
			columns ($1) ($2)
                }
	
		Curve {
        	        legend "analytique"
                	origin "ref"
	                file conduc_genepi_instat_pb_Diffusion_chaleur.out
        	        Style lines
			columns ($1) ((100.-0.5*20.*3.14159265358979/(2.*0.05)*exp(-(0.5/(0.5*1000.))*(3.14159265358979/(2.*0.05))*(3.14159265358979/(2.*0.05))*($1)))*0.05)
                }
	}
}
