dimension 3

Pb_hydraulique pb
domaine dom

# BEGIN MESH #
Read_file geometry.geo ;
tetraedriser_homogene_compact dom
# END MESH #

# BEGIN PARTITION
Partition dom
{
    Partition_tool metis { nb_parts 4 }
    Larg_joint 2
    zones_name DOM
}
End
END PARTITION #

# BEGIN SCATTER
Scatter DOM.Zones dom
END SCATTER #

VEFPreP1B dis
Read dis { P0 P1 Pa Cl_pression_sommet_faible 0 }

Scheme_Euler_explicit mon_schema
Read mon_schema
{
    tinit   0
    tmax    30.
    dt_min  2.e-7
    dt_max  2.
    dt_impr 1.
    dt_sauv 300.
    seuil_statio 1.e-7
    facsec  0.5
}

Fluide_Incompressible fluide
Read fluide
{
    mu      Champ_Uniforme 1 1.002e-3
    rho     Champ_Uniforme 1 1000
}

Champ_Uniforme gravite
Read gravite 3  9.81   0.   0.
Associate fluide gravite

Associate pb dom
Associate pb fluide
Associate pb mon_schema

Discretize pb dis

Read pb
{
    Navier_Stokes_standard
    {
        solveur_pression Petsc cholesky { }
        convection { amont }
        diffusion { }
        initial_conditions  { vitesse Champ_Uniforme 3 0 0 0 }
        boundary_conditions 
        {
            droite      paroi_fixe
            gauche      paroi_fixe
            bas         Frontiere_ouverte_vitesse_imposee   Champ_front_Uniforme 3 0. 0. 1.
            haut        Frontiere_ouverte_pression_imposee  Champ_front_Uniforme 1 0.
            devant      paroi_fixe
            derriere    paroi_fixe
        }
    }


    Post_processing
    {
        Definition_champs
        {
            energie_cine_elem Predefini { Pb_champ pb energie_cinetique_elem }
            pressure_tot Transformation
            {
                methode formule expression 1 p_pa+p_hydro-rho*9.81*2.+energie_cine_elem
                sources_reference { energie_cine_elem }
                sources 
                {
                    RefChamp { Pb_champ pb pression_pa              nom_source p_pa } ,
                    RefChamp { Pb_champ pb pression_hydrostatique   nom_source p_hydro } ,
                    RefChamp { Pb_champ pb masse_volumique          nom_source rho }
                }
            }
        }
        Format lata 
        Fields dt_post 1
        {
            pressure                    elem
            pression                    elem
            pression_pa                 elem
            P_star                      elem
            vitesse                     faces
            energie_cinetique_totale    elem
            energie_cinetique_elem      elem

            pression_hydrostatique      elem
            pressure_tot                elem
        }

        Probes 
        {
            pressure    nodes   pressure                    periode 0.1 segment 13  2.23   2.25   0.4    2.23   2.25   9.6
            pression    nodes   pression                    periode 0.1 segment 13  2.23   2.25   0.4    2.23   2.25   9.6
            pression_pa nodes   pression_pa                 periode 0.1 segment 13  2.23   2.25   0.4    2.23   2.25   9.6
            p_star      nodes   p_star                      periode 0.1 segment 13  2.23   2.25   0.4    2.23   2.25   9.6
            p_hydro     grav    pression_hydrostatique      periode 0.1 segment 13  2.23   2.25   0.4    2.23   2.25   9.6

            ec_totale   grav    energie_cinetique_totale    periode 0.1 segment 13  2.23   2.25   0.4    2.23   2.25   9.6
            ec_elem     grav    energie_cinetique_elem      periode 0.1 segment 13  2.23   2.25   0.4    2.23   2.25   9.6

            p_tot       grav    pressure_tot                periode 0.1 segment  7  0.4    2.25   4.8    4.8    2.25   4.8
            p_hydro2    grav    pression_hydrostatique      periode 0.1 segment  7  0.4    2.25   4.8    4.8    2.25   4.8
            p_pa        nodes   pression_pa                 periode 0.1 segment  7  0.4    2.25   4.8    4.8    2.25   4.8
            ec_elem2    grav    energie_cinetique_elem      periode 0.1 segment  7  0.4    2.25   4.8    4.8    2.25   4.8

        }
    }

    Post_processings
    {
        bord_haut
        {
            domaine dom_boundaries_haut
            Format lata 
            Fields dt_post 1
            {
                pression_pa                 elem
            }
        }
    }

}

Solve pb
End

