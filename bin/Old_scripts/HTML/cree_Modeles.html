#!/bin/bash

rep_modeles=$TRUST_ROOT/Modeles
fichier=$rep_dev/.Modeles.html

# Ecriture du fichier :
echo $ECHO_OPTS "<!--NewPage-->
<html> 
<head>
<title> Modeles </title>
</head>
<body>
<BODY BGCOLOR="#C5D5D5" TEXT="#23238E" LINK="#E47833" ALINK="#007FFF" VLINK="#007FFF">
<a href="$TRUST_ROOT/doc/TRUST.html"> TRUST </a> | <a href=$rep_dev/.Atelier.html>Atelier</a> | <a href=$rep_dev/.Fichiers_atelier.html>Fichiers de l'atelier</a><br>
<PRE>
<HR>
<h1>Creation d'une nouvelle classe a partir d'un modele</h1>
<HR>" > $fichier
#<FORM METHOD="Compiler" ACTION="$TRUST_ROOT/form/Compiler_opt.ksh?"><input type="submit" value="Compiler">  Compiler la version optimisee  <a href=$rep_exec_opt/.Makefile.nom>Makefile</a> $mes_opt</FORM>
#echo $ECHO_OPTS "<LI>Creer un nouveau ou une nouvelle :" >> $fichier
[ ! -d $rep_modeles ] && exit
cd $rep_modeles
for modele in `ls *.modele`
do
   nom=`basename $modele .modele`
   rm -f .$nom"_modele.data" 2>/dev/null && ln -s -f $nom"_modele_h" .$nom"_modele.data" 2>/dev/null
   type=`$TRUST_Awk '(NR==1) {print $1}' $modele`
   case $type in
      classe) un="une";
              name=`$TRUST_Awk '(NR==1) {print $2}' $modele`;
	      if [ ${#name} != 0 ]
	      then
	         mere=`$TRUST_Awk '/public/ && ($1=="class") {print $NF}' $nom"_modele_h"`;
	         echo $ECHO_OPTS " <LI>Depuis un <a href=$rep_modeles/.$nom"_modele.data">modele</a>, <a href=$rep_modeles/$modele>creation d'$un classe $name</a> heritant de <a href=$TRUST_ROOT/doc/$mere.html>$mere</a>" >> $fichier
              else
	         echo $ECHO_OPTS " <LI>Depuis un <a href=$rep_modeles/.$nom"_modele.data">modele</a>, <a href=$rep_modeles/$modele>creation d'$un classe</a>" >> $fichier	      
	      fi
	      ;;
      fichier) un="un";
               name=`$TRUST_Awk '(NR==1) {print $2}' $modele`;
      	       echo $ECHO_OPTS " <LI><a href=$rep_modeles/$modele>Creation d'$un $type</a> de suffixe .$name" >> $fichier
	       ;;
      *) echo $ECHO_OPTS "Probleme:$type non reconnu!";;
   esac
done

echo $ECHO_OPTS "<HR><h1>Modules</h1>" >> $fichier
cd $TRUST_ROOT
find * -name .sccs -type d -exec dirname {} \; >> $fichier

#echo $ECHO_OPTS "<HR><h1>Librairies</h1>" >> $fichier
#cd $TRUST_LIB
#ls -t *.sl >> $fichier

echo $ECHO_OPTS "<HR>
</body>
</html> " >> $fichier

rm -f $fichier"?" && ln -s -f $fichier $fichier"?"
